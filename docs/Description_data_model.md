# Описание модели данных

Звездочкой (*) отмечены обязательные поля.

## Аккаунт

Используется встроенная модель [User](https://docs.djangoproject.com/en/3.2/ref/contrib/auth/) из django.contrib.auth.models.
Необходимо дополнить встроенную модель полем "Номер телефона" (Phone_number) с использованием его в качестве уникального идентификатора пользователя.
Роли (Permission) Руководитель курса, Учащийся и другие назначаются c использованием моделей и методов, предоставляемых django.contrib.auth.models.

Авторизация в системе с использованием JWT токенов (access_token и refresh_token). 
Реализовать с использованием [плагина](https://django-rest-framework-simplejwt.readthedocs.io/en/latest/index.html) аутентификации JWT для Django REST Framework.

Обеспечить подтверждение указанного пользователем e-mail. 
Сообщение на указанный пользователем e-mail c кодом или редиректом для подтверждения.
Тексты сообщений о подтверждении e-mail, а также другие стандартные уведомления по e-mail (смена пароля, об успешном подтверждении
e-mail, телефона и т.п.) и их оформление согласовать с заказчиком.

Обеспечить подтверждение указанного пользователем номера телефона. Способ подтверждения нужно уточнить у заказчика.
Возможен вариант, что пользователя будут проверять прозвоном со стороны сотрудников ЛизаАлерт и подтверждать вручную.
Такой вариант подтверждения (правда без указания что будет прозвон есть в workflow администратора).

Первоначально проверку e-mail и номера телефона реализовать средствами django, в дальнейшем рассмотреть 
целесообразность использования асинхронной очереди задач типа Celery.


**Для всех таблиц ниже используется отдельная схема БД Postgresql (например, content)**

## Волонтер

Имя модели - **Volunteer**
Таблица БД - **volunteers**

Поля модели:

- **id*** - уникальный идентификатор, тип uuid, первичный ключ
- **user*** - тип OneToOneField, отношение один-к-одному к модели **User**
- **full_name*** - ФИО волонтера, тип CharField, длина 255
- **birth_date*** - дата рождения, тип DateField
- **location*** - географический регион, тип ForeignKey (один ко многим) к модели **Location** (Географический регион)
- **call_sign*** - позывной на форуме, тип CharField, длина 50
- **photo** - путь к файлу фотографии волонтера, тип ImageField
- **thumbnail** - путь к миниатюре волонтера, тип ThumbnailerImageField
- **level** - уровень, тип ForeignKey (один ко многим) к модели **Level** (Уровень)
- **confirmed** - статус подтверждения волонтера Администратором, тип BooleanField
- **who_confirmed** - кто подтвердил статус пользователя, тип OneToOneField, отношение один-к-одному к модели **User**
- **badges** - значки, тип ManyToManyField (многие ко многим) к модели **Badge** (Значки), через модель **VolunteerBadge**
- **courses** - курсы, тип ManyToManyField (многие ко многим) к модели **Сourse** (Курсы), через модель **VolunteerCourse**
- **created_at*** - дата создания записи об учащемся, тип DateTimeField, сделать автоматическое проставление текущего времени
- **updated_at*** - дата обновления записи об учащемся, тип DateTimeField с таймстамп, сделать автоматическое проставление текущего времени

Примечание: Реализовать метод модели по генерации и сохранению миниатюры (thumbnail) при загрузке фотографии пользователя.
Использовать библиотеку [easy-thumbnails](https://pypi.org/project/easy-thumbnails/2.7.2/)

## Географический регион

Имя модели - **Location**
Таблица БД - **locations**

Поля модели:

- **id*** - уникальный идентификатор, тип uuid, первичный ключ
- **region*** - наименование региона, тип текст, длина 255
- **created_at*** - дата создания записи о регионе, тип DateTimeField, сделать автоматическое проставление текущего времени
- **updated_at*** - дата обновления записи о регионе, тип DateTimeField, сделать автоматическое проставление текущего времени

## Уровень

Имя модели - **Level**
Таблица БД - **levels**

Поля модели:

- **id*** - уникальный идентификатор, тип uuid, первичный ключ
- **name*** - наименование уровня, тип CharField, длина 20, (выбор из Новичок, Бывалый, Профессионал)
- **description** - описание уровня и условий его достижения, тип TextField
- **created_at*** - дата создания записи об  уровне, тип DateTimeField, сделать автоматическое проставление текущего времени
- **updated_at*** - дата обновления записи об уровне, тип DateTimeField, сделать автоматическое проставление текущего времени

## Значок

Имя модели - **Badge**
Таблица БД - **badges**

Поля модели:

- **id*** - уникальный идентификатор, тип uuid, первичный ключ
- **name*** - наименование значка, тип CharField, длина 40
- **description** - описание значка и условий его получения, тип TextField
- **image** - путь к графическому изображению значка, тип ImageField
- **created_at*** - дата создания записи о значке, тип DateTimeField, сделать автоматическое проставление текущего времени
- **updated_at*** - дата обновления записи о значке, тип DateTimeField, сделать автоматическое проставление текущего времени

## Учащиеся <-> Значки (многие-ко-многим)

Имя модели - **VolunteerBadge**
Таблица БД  - **volunteers_badges**

Поля модели:

- **id*** - уникальный идентификатор, тип uuid, первичный ключ
- **volunteer*** - тип ForeignKey к модели волонтера **Volunteer**
- **badge*** - тип ForeignKey к модели значка **Badge**
- **created_at*** - дата создания записи о свзяи волонтер - значок, тип DateTimeField, сделать автоматическое проставление текущего времени

## Учащиеся <-> Курсы (многие-ко-многим)

Имя модели - **VolunteerCourse**
Таблица БД  - **volunteers_courses**

Поля модели:

- **id*** - уникальный идентификатор, тип uuid, первичный ключ
- **volunteer*** - тип ForeignKey к модели волонтер **Volunteer**
- **course*** - тип ForeignKey к модели курса **Course**
- **status*** - статус курса, тип CharField, длина 20, выбор из Активный, Не активный, Пройден, Вы записаны
- **assessment*** - оценка по результатам прохождения курса, тип FloatField, валидация диапазона: от 0 до 100,0. Если курс не проходился, то 0.
- **created_at*** - дата создания записи о связи волонтер - курс, тип DateTimeField, сделать автоматическое проставление текущего времени

Создать уникальный индекс (UniqueConstraint) по полям [volunteer, course, status] чтобы конкретный курс был привязан к пользователю только с одним из возможных статусов.

Реализовать метод модели создания записей в таблице volunteers_lessons по всем урокам курса при изменении status на Вы записаны.

_Уточнить необходимость статуса "Не активный", так как он дублируется по функциональности со статусом "Пройден"_

## Сертификат

Имя модели - **Sertificate**
Таблица БД - **sertificates** 

Поля модели:

- **id*** - уникальный идентификатор, тип uuid, первичный ключ
- **volunteer*** - тип ForeignKey к модели волонтер **Volunteer**
- **course*** - тип ForeignKey к модели курса **Course**
- **final_assessment*** - итоговая оценка по результатам прохождения курса, тип FloatField, валидация диапазона: от (_уточнить нижний процент_) до 100,0.
- **sertificate_path*** - путь к файлу с сертификатом, тип FileField
- **issued** - руководитель курса, кто выдал сертификат, тип OneToOneField, отношение один-к-одному к модели **User**
- **created_at*** - дата создания записи о сертификате, тип DateTimeField, сделать автоматическое проставление текущего времени

## Курс

Имя модели - **Course**
Таблица БД - **courses**

Поля модели:

- **id*** - уникальный идентификатор, тип uuid, первичный ключ
- **title*** - название курса, тип CharField, длина 120
- **direction*** - направление, тип CharField, длина 60, выбор из заданного списка (_уточнить список направлений_)
- **level*** - уровень, тип ForeignKey (один ко многим) к модели **Level** (Уровень)
- **format*** - формат курса, длина 60, выбор из заданного списка (_уточнить список форматов_)
- **start_date*** - дата начала курса, тип DateField
- **cover_path** - путь к обложке курса, тип FileField
- **short_description*** - краткое описание курса, тип CharField, длина 120
- **full_description*** - полное описание курса, тип TextField
- **skills** - тип ManyToManyField (многие ко многим) к модели **Skill** (Навыки), через модель **CourseSkill**
- **faq** - тип ManyToManyField (многие ко многим) к модели **FAQ** (Часто задааваемые вопросы), через модель **CourseFAQ**
- **contents*** - ManyToManyField (многие ко многим) к модели **Chapter** (Главы), через модель **CourseChapter**
- **duration*** - продолжительность курса (вычисляемое поле на основании информации о продолжительности всех уроков курса), тип SmallIntegerField
- **number_of_classes*** - количество занятий (вычисляемое поле на основании количества уроков в курсе), тип SmallIntegerField
- **attempts_limit*** - количество попыток на прохождение курса. Если задано 0, то количество попыток не ограничено. Тип SmallIntegerField, валидация от 0 до 10 (_уточнить возможную верхнюю границу диапазона_)
- **user_created*** - пользователь создавший курс, тип OneToOneField, отношение один-к-одному к модели **User**
- **user_modified*** - последний редактировавший курс, тип OneToOneField, отношение один-к-одному к модели **User**
- **ready*** - статус готовности готов/не готов, тип BooleanField
- **visible*** - статус видимости курса вкл./выкл., тип BooleanField
- **published*** - статус публикации курса, тип BooleanField
- **created_at*** - дата создания записи о курсе, тип DateTimeField, сделать автоматическое проставление текущего времени
- **updated_at*** - дата обновления записи о курсе, тип DateTimeField, сделать автоматическое проставление текущего времени

## Навыки

Имя модели - **Skill**
Таблица БД - **skills**

Поля модели:

- **id*** - уникальный идентификатор, тип uuid, первичный ключ
- **title*** - название навыка, тип CharField, длина 120
- **description*** - описание навыка, тип CharField, длина 255
- **user_created*** - пользователь создавший описание навыка, тип OneToOneField, отношение один-к-одному к модели **User**
- **user_modified*** - последний редактировавший описания навыка, тип OneToOneField, отношение один-к-одному к модели **User**
- **created_at*** - дата создания записи о навыке, тип DateTimeField, сделать автоматическое проставление текущего времени
- **updated_at*** - дата обновления записи о навыке, тип DateTimeField, сделать автоматическое проставление текущего времени

## Курсы <-> Навыки (многие-ко-многим)

Имя модели - **CourseSkill**
Таблица БД - courses_skills

Поля модели:

- **id*** - уникальный идентификатор, тип uuid, первичный ключ
- **course*** - тип ForeignKey к модели курса **Course**
- **skill*** - тип ForeignKey к модели навыка **Skill**
- **created_at*** - дата создания записи о связи курс - навык, тип DateTimeField, сделать автоматическое проставление текущего времени

## FAQ

Имя модели - **FAQ**
Таблица БД - **faq**

Поля модели:

- **id*** - уникальный идентификатор, тип uuid, первичный ключ
- **question*** - вопрос, тип CharField, длина 120
- **answer*** - ответ на вопрос, тип CharField, длина 255
- **user_created*** - пользователь создавший ответ, тип OneToOneField, отношение один-к-одному к модели **User**
- **user_modified*** - пользователь последний редактировавший ответ, тип OneToOneField, отношение один-к-одному к модели **User**
- **created_at*** - дата создания записи об ответе на вопрос, тип DateTimeField, сделать автоматическое проставление текущего времени
- **updated_at*** - дата обновления записи об ответе на вопрос, тип DateTimeField, сделать автоматическое проставление текущего времени

## Курсы <-> FAQ (многие-ко-многим)

Имя модели - **CourseFAQ**
Таблица БД - **courses_faq**

Поля модели:

- **id*** - уникальный идентификатор, тип uuid, первичный ключ
- **course*** - тип ForeignKey к модели курса **Course**
- **faq*** - тип ForeignKey к модели часто задаваемых вопросов **FAQ**
- **created_at*** - дата создания записи о связи курс - ответ на вопрос, тип DateTimeField, сделать автоматическое проставление текущего времени

## Глава

Имя модели - **Chapter**
Таблица БД - **capters**

Поля модели:

- **id*** - уникальный идентификатор, тип uuid, первичный ключ
- **title** - название главы, тип CharField, длина 120 _(необязательно, если уроки не делятся на главы)_
- **lessons** - тип ManyToManyField (многие ко многим) к модели **Lesson** (Урок), через модель **СhapterLesson**
- **user_created*** - пользователь создавший главу, тип OneToOneField, отношение один-к-одному к модели **User**
- **user_modified*** - пользователь последний редактировавший главу, тип OneToOneField, отношение один-к-одному к модели **User**
- **created_at*** - дата создания записи о главе, тип DateTimeField, сделать автоматическое проставление текущего времени
- **updated_at*** - дата обновления записи о главе, тип DateTimeField, сделать автоматическое проставление текущего времени

Примечание: _поле **lessons** тип ManyToManyField имеет смысл, только если предполагается, что одни и те же уроки 
могут быть привязаны к разным курсам (главам в рамках курса). Например, какие-либо вводные уроки или правила безопасности. 
Если нет, то достаточно будет типа ForeignKey от каждого урока к главе (один-ко-многим)_

## Курсы <-> Главы (многие-ко-многим)

Имя модели - **CourseChapter**
Таблица БД - **courses_chapters**

Поля модели:

- **id*** - уникальный идентификатор, тип uuid, первичный ключ
- **course*** - тип ForeignKey к модели курса **Course**
- **chapter*** - тип ForeignKey к модели главы урока **Chapter**
- **order_number*** - порядковый номер главы, тип SmallIntegerField, проверка нижнего дипазона >= 1
- **created_at*** - дата создания записи о связи курс - глава урока, тип DateTimeField, сделать автоматическое проставление текущего времени

Создать уникальный индекс (UniqueConstraint) по полям [course, chapter, order_number] чтобы конкретная глава в рамках курса имела уникальный порядковый номер.
_Требует уточнения, так как в случае множественного изменения порядка глав в курсе изменения необходимо будет проводить в одной транзакции с отключенным контролем конфиликтов до завершения транзакции_

## Уроки

Имя модели - **Lesson**
Таблица БД - **lessons**

Поля модели:

- **id*** - уникальный идентификатор, тип uuid, первичный ключ
- **title*** - название урока, тип CharField, длина 120
- **description** - описание урока, тип TextField (_требует уточнения: как хранить форматированный текст в БД и в каком виде отдавать в frontend_)
- **type*** - тип урока, тип CharField, длина 20, выбор из перечня Урок, Видеоурок, Вебинар, Тест (Квиз)
- **tags** - ключевые слова урока, тип CharField, длина 255
- **duration*** - продолжительность урока, минут, тип SmallIntegerField
- **user_created*** - пользователь создавший урок, тип OneToOneField, отношение один-к-одному к модели **User**
- **user_modified*** - последний редактировавший урок, тип OneToOneField, отношение один-к-одному к модели **User**
- **ready*** - статус готовности готов/не готов, тип BooleanField
- **visible*** - статус видимости урока вкл./выкл., тип BooleanField
- **published*** - статус публикации урока, опубликован - да/нет,тип BooleanField
- **additional*** - дополнительный урок - да/нет, тип BooleanField
- **diploma*** - дипломный урок - да/нет, тип BooleanField
- **created_at*** - дата создания записи об уроке, тип DateTimeField, сделать автоматическое проставление текущего времени
- **updated_at*** - дата обновления записи об уроке, тип DateTimeField, сделать автоматическое проставление текущего времени

## Главы <-> Уроки (многие-ко-многим)

Имя модели - **ChapterLesson**
Таблица БД - **chapters_lessons**

Поля модели:

- **id*** - уникальный идентификатор, тип uuid, первичный ключ
- **chapter*** - тип ForeignKey к модели главы урока **Chapter**
- **lesson*** - тип ForeignKey к модели курса **Lesson**
- **order_number*** - порядковый номер урока в главе, тип SmallIntegerField, проверка нижнего дипазона >= 1
- **created_at*** - дата создания записи о связи курс - глава урока, тип DateTimeField, сделать автоматическое проставление текущего времени

Создать уникальный индекс (UniqueConstraint) по полям [chapter, lesson, order_number] чтобы конкретный урок в рамках главы имел уникальный порядковый номер. Необходимо для сортировки.
_Требует уточнения, так как в случае множественного изменения порядка уроков в главе или добавления урока между имеющимися уроками изменения необходимо будет проводить по всем урокам в одной транзакции с отключенным контролем конфиликтов до завершения транзакции_

## Видеоурок

Имя модели - **VideoLesson**
Таблица БД - **video_lessons**

Поля модели:

- **id*** - уникальный идентификатор, тип uuid, первичный ключ
- **lesson*** - урок с описанием, тип ForeignKey (один-ко-многим) к модели урока **Lesson**
- **video*** - путь к файлу с видео, тип FileField (_требует уточнения_)
- **user_created*** - пользователь создавший видеоурок (загрузивший видео), тип OneToOneField, отношение один-к-одному к модели **User**
- **user_modified*** - последний редактировавший видеоурок (обновивший видео), тип OneToOneField, отношение один-к-одному к модели **User**
- **created_at*** - дата создания записи о видеоуроке, тип DateTimeField, сделать автоматическое проставление текущего времени
- **updated_at*** - дата обновления записи о видеоуроке, тип DateTimeField, сделать автоматическое проставление текущего времени

## Вебинар

Имя модели - **Webinar**
Таблица БД - **webinars**

Поля модели:

- **id*** - уникальный идентификатор, тип uuid, первичный ключ
- **lesson*** - урок с описанием, тип ForeignKey (один-ко-многим) к модели урока **Lesson**
- **url_webinar*** - ссылка на вебинар, тип URLField
- **start_date*** - дата и время начала вебинара, тип DateTimeField
- **user_created*** - пользователь создавший ссылку на вебинар, тип OneToOneField, отношение один-к-одному к модели **User**
- **user_modified*** - последний редактировавший ссылку на вебинар, тип OneToOneField, отношение один-к-одному к модели **User**
- **created_at*** - дата создания записи о ссылке на вебинар, тип DateTimeField, сделать автоматическое проставление текущего времени
- **updated_at*** - дата обновления записи о ссылке на вебинар, тип DateTimeField, сделать автоматическое проставление текущего времени

## Волонтер <-> Урок (многие-ко-многим)

Имя модели - **VolunteerLesson**
Таблица БД - **volunteers_lessons**

Поля модели:

- **id*** - уникальный идентификатор, тип uuid, первичный ключ
- **volunteer*** - тип ForeignKey к модели волонтера **Volunteer**
- **lesson*** - тип ForeignKey к модели урока **Lesson**
- **passed*** - статус прохождения урока, тип BooleanField, по умолчанию False
- **start_date** - дата начала (первое отрытие урока), тип DateTimeField
- **end_date** - дата завершения урока (переход к следующему уроку или тесту), тип DateTimeField
- **created_at*** - дата создания записи о связи волонтер - урок, тип DateTimeField, сделать автоматическое проставление текущего времени
- **updated_at*** - дата обновления записи о связи волонтер - урок, тип DateTimeField, сделать автоматическое проставление текущего времени

Создать уникальный индекс (UniqueConstraint) по полям [volunteer, lesson, passed] чтобы конкретный урок для пользователя имел уникальный статус прохождения. 

При активации курса с помощью метода модели **VolunteerCourse** иницирировать создание записей в БД по всем урокам курса с заполнением поля passed значением по умолчанию. 


## TODO

- определиться с моделями для тестов. Возможно стоит рассмотреть следующие имеющиеся реализации тестов/квизов на базе django
и взять их за основу:
  - [https://github.com/tomwalker/django_quiz](https://github.com/tomwalker/django_quiz) - Предпочтительный вариант, есть возможность создания тестов с множественным выбором, 
  сохранение прогресса, возврат к незаконченному тесту и продолжение работы с ним и т.п. Потребуется адаптировать и протестировать с django 3.2
  - [https://github.com/sswapnil2/django-quiz-app/blob/master/quiz/models.py](https://github.com/sswapnil2/django-quiz-app/blob/master/quiz/models.py) - Вариация предыдущей реализации

## ВОПРОСЫ

1. Требует уточнения формат хранения текстовых описаний уроков в БД. Судя по макету описание предполагает 
форматирование текста. Сейчас не заявлено, но возможно кроме текста будут также рисунки, 
схемы в самом тексте. Хранение форматированного текста предполагает использование дополнительных библиотек типа BBcode. Наличие рисунков может отразиться на модели Уроков.
2. Требует уточнения необходимость использовать телефонного номера как уникального идентификатора, так как верификация номера
подразумевает отправку платных смс.