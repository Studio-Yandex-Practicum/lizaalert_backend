## Принципы код-ревью (©YandexPracticum)

Во время работы над проектом вам придётся проводить ревью кода своих товарищей. 
Это нужно, чтобы заранее найти ошибки и несоответствия с конвенциями, а также научиться чему-то новому. 
Ревью спасает от «замыленного глаза» и не даёт коду превратиться в хтонического монстра. А также позволяет быть в курсе происходящего в проекте и видеть картину в целом. 

### Основные цели ревью:
- **Проектирование**. Вы должны проверить, хорошо ли спроектирован код и насколько он подходит для решения задачи.
- **Функциональность**. Проверьте, реализованы бизнес-требования. Возможно, автор упустил неявное поведение компонента, который работает не так, как ожидается.
- **Сложность**. Задайтесь вопросом: а возможно ли упростить код? Может, коллега увлёкся преждевременной оптимизацией, которая делает код не читаемым?
- **Тесты**. Убедитесь, что автор кода написал тесты, которые охватывают наибольшее количество пользовательских сценариев, даже самые невероятные.
- **Стандарт оформления кода**. Убедитесь, что в коде соблюдаются правила, принятые в команде. Часто приходится гадать, зачем нужна та или иная переменная.
- **Менторинг**. Во время ревью у вас появляется прекрасная возможность получить знания и опыт от своих коллег, а также поделиться своим опытом с ними.

### Принципы

Задача ревьюверов — убедиться, что кодовая база со временем не теряет актуальности и не замусоривается. Чтобы добиться такого результата, 
необходимо найти баланс между скоростью выполнения задач и качеством кода.

Можно подумать, что задача ревьювера — всеми силами заставить другого человека написать код так, как написал бы он сам. 
Это неверный подход. Когда вы просматриваете чужие изменения, обратите внимание, не ухудшает ли написанный код общую архитектуру проекта. 
Зачастую программисты, поджимаемые сроками, жертвуют чистотой кода в угоду бизнесу. Если не пресекать такое поведение на код-ревью, 
то ваш проект довольно быстро превратится в запутанный клубок костылей, который будет проще сжечь, чем улучшить. 
Но если проект уже запущен, вам придётся жить и работать в этом лабиринте, который построили вы с коллегами. 
В итоге у разработчиков будет негативное отношение к проекту и низкая мотивация продолжать работу.

Доказано, что в физическом мире порядок на рабочем месте увеличивает эффективность самой работы. Ситуация: столяр до обеда ищет рубанок. 
Потом он тратит оставшиеся часы, чтобы разобраться, как пользоваться инструментом после того, как предыдущий мастер внёс в его конструкцию изменения. 
Такой столяр будет менее эффективен, чем работник, у которого все инструменты находятся в нужных местах и работают предсказуемо.

Ваше рабочее место и ваша главная зона ответственности — код. Там вы проводите бо́льшую часть своего времени. Следить за его чистотой не менее важно, 
чем соблюсти требования новой задачи. Ваша задача как автора — найти баланс между скоростью выполнения задач и качеством кода. 
Ваша задача как ревьювера — проследить, чтобы коллеги не усложнили дальнейшую разработку. Грязный хак кажется маленькой каплей в проекте, 
но одна такая поблажка неисправимо тянет за собой следующие.

В общем, ревьювер должен одобрять код, когда он определённо улучшает общее состояние кодовой базы, даже если код неидеален. 
Если можно написать проще — нужно сказать об этом в ревью. Возможно, упрощённый вариант просто не пришёл автору в голову.
Ревьювер также имеет право оставлять замечания, которые необязательно исправлять. Под такое правило обычно подходит разного рода «вкусовщина». 
Такие замечания принято выделать по-особенному, например, поставив префикс `придирка`. Например: `Придирка: переименуй, пожалуйста, переменную data так, 
чтобы название лучше отражало её содержание`.

При удалённой разработке ревьювер также может задавать вопросы по коду, получать ответы и на этом основании принимать решения об одобрении. 
Такое встречается достаточно часто, особенно когда команды не имеют возможности в любой момент пообщаться онлайн. 
Важно чтобы ревьювер принимал решения не сиюминутно, а взвешенно оценивая риски, особенно если на ревью прислали много изменений.

### Менторинг

Проверка кода может сыграть важную роль в обучении разработчиков чему-то новому в отношении языка, 
фреймворка или общих принципов проектирования программного обеспечения.
Нормально оставлять комментарии, которые помогают разработчику узнать что-то новое. Обмен знаниями — это часть улучшения состояния кода с течением времени. 
Просто имейте в виду, если ваш комментарий носит чисто образовательный характер, но не критичен, поставьте перед ним префикс `Nit` или иным образом укажите, 
что автор не обязан разрешать его. Например:` Nit: Вместо использования Union[int, None] можно использовать Optional[int]`.

### Конфликты

В случае неразрешимого спора между ревьювером и автором обе стороны обязаны стремиться к компромиссу. 
Если к нему так и не получается подойти в комментариях, необходима личная встреча для ускорения процесса. Если спор остался неразрешённым, 
то проблема выносится на обсуждение команде или руководителю.
Какие принципы использовать при разрешении конфликтов:
- Технические факты и данные имеют приоритет над мнениями и личными предпочтениями.
- В вопросах стилистики абсолютный авторитет — стандарт по написанию. Любые стилистические точки или пробелы, которых нет в стандарте, 
считаются личными предпочтениями. Стиль должен соответствовать тому, который утвердила команда или руководитель. Если стиля нет, подстраивайтесь под авторский.
- Если возник конфликт вокруг паттернов проектирования, и автор может доказать, что его решение равнозначно решению ревьювера, то принимается сторона автора.

## На что обращать внимание

### Проектирование

- Органично ли взаимодействуют компоненты системы друг с другом?
- Укладывается ли новый код в уже сложившуюся кодовую базу?

Например, проект на Django использует Class Based Views, а вы решили написать вьюшку с использованием функций.
Когда какая-то часть проекта явно выбивается из общего стиля, у программиста обязательно возникнет вопрос, 
почему здесь написано именно так? Что заставило другого программиста отойти от стандарта? Может, здесь есть какой-то неочевидный баг? 
На подобные сомнения и попытки выяснить правду уйдёт время, которое можно потратить на что-то более полезное.

### Функциональность

- Делает ли этот код то, что задумал разработчик?
- Удобно ли пользоваться интерфейсом, который разработал разработчик?

Речь идёт как о графическом интерфейсе, так и о REST-интерфейсе для клиентского приложения.

- Удобно ли использовать реализованные компоненты внутри текущей кодовой базы для других разработчиков?

Автор кода должен хорошо протестировать код — он должен покрыть все возможные бизнес-сценарии. Тесты должны быть написаны до проверки кода. 
Ревьювер должен подумать уже о крайних случаях: представить себя пользователем этого кода и запустить его в дебагере, 
чтобы лучше понять поведение изменений в программе. Например, если проводится интеграция с внешним сервисом, нужно проверить, 
корректно ли обрабатываются ошибки и недоступность сервиса, а ещё какие ошибки передаются клиентским приложениям.

- Если изменения затрагивают UI, полезно приложить скриншоты изменений, так как при чтении кода сложно представить, как будет изменён интерфейс.

Благодаря этому ревьюверу будет проще понять, что нужно проверить. Цените чужое время.

- Если изменения затрагивают информационную безопасность, и у вас нет должной квалификации, в этом нет ничего страшного.

Обратитесь к коллегам, которые более осведомлены в этой области.
- В git не должны попадать секретные переменные. А если всё-таки попали, то лучше всего выявить это на этапе ревью.
- Особое внимание уделите параллелизму. Он может быть неявным.

Например, у вас есть баланс в базе данных. Что произойдёт, если два пользователя решат списать деньги? 
Как обработать ситуацию, если при одновременном списании баланс опустится ниже нуля?

### Сложность

- Насколько сложен написанный код?
Под сложностью имеется в виду то, насколько быстро получается разобраться, что делает написанный код. Разработчики могут наплодить ошибок, 
- когда попытаются вызвать или изменить этот код.

Если вы как ревьювер не понимаете, что написано, то не нужно стесняться: спросите автора, что он имел в виду. Если вам не хочется разбираться, 2
то и у других разработчиков будет отсутствовать это желание. Поэтому уточнение и переписывание непонятного куска кода упростит вашу жизнь и 
жизнь инженеров, которые придут в вашу команду.

- Обращайте внимание на преждевременную оптимизацию и оверинжиниринг.

Всегда есть великий соблазн написать универсальную функцию, класс или интерфейс, чтобы покрыть все возможные ситуации и облегчить жизнь «потомкам». 
Зачастую всё это — большие заблуждения, поэтому компонент должен делать ровно то, для чего он предназначен.
Нужно решать проблемы, которые возникли в данный момент, а не проблемы, которые, возможно, возникнут в будущем.
Будущую проблему нужно решать в тот момент, как только она возникнет. Тогда у этих проблем будут решения, которые больше подойдут для 
будущего состояния проекта. Например, новый проект стоит начать делать на монолитной архитектуре, а не на микросервисной, 
ибо на старте нет проблем с масштабированием команды.

### Тесты

- Написаны ли для кода соответствующие тесты?

Это могут быть юнит-тесты, а также компонентные или интеграционные тесты — всё зависит от изменений.

Убедитесь, что тесты правильные, разумные и полезные. Тесты не тестируют сами себя — в их адекватности и действенности может убедиться только человек.

- Действительно ли не пройдут тесты, если код сломан?
- Если код под тестами изменится, начнут ли они давать ложные срабатывания?
- Делает ли каждый тест простые и полезные проверки?
- Правильно ли разделены тесты между разными методами?

Помните, что тесты — это тоже код, который необходимо поддерживать. Тесты должны проверяться ревьювером так же, как и остальной код.

### Стандарт оформления кода

- Выбраны ли хорошие имена для переменных, функций, классов и других составляющих кода?

Хорошее имя — достаточно длинное, чтобы полностью передать, что это за элемент и что он делает. Но оно не на должно быть настолько длинным, 
что его становится трудно читать.

- Написал ли разработчик понятные комментарии?
- Все ли комментарии действительно необходимы?

Обычно комментарии полезны, когда они объясняют, почему существует код. Они не должны объяснять, что он делает. 
Если код недостаточно понятный, чтобы объяснить себя, его следует упростить.

Есть некоторые исключения: например, регулярные выражения и сложные алгоритмы часто получают большую пользу от комментариев, 
которые объясняют, что они делают. Но в большинстве случаев комментарии предназначены для информации, которую сам код не может содержать. 
Например, для обоснования решения.

Также может быть полезно просмотреть комментарии, которые были до этого. Может быть, есть TODO, который теперь можно удалить, или комментарий, 
запрещающий вносить какое-либо изменение.

Обратите внимание, что комментарии отличаются от документации классов, модулей или функций. Они должны выражать назначение фрагмента кода, 
как его следует использовать и как он при этом себя ведёт.

### Контекст

Зачастую изменения в коде бывают очень маленькими, поэтому есть большой соблазн проверить «по диагонали» пять коротких строчек кода. 
Но чтобы их проверить, важно понимать контекст, где они используются. Ревьювер должен трезво оценить, подходят ли эти изменения в этом месте.

### Благодарность автору

Многие ревьюверы концентрируются на ошибках и не обращают внимания на хорошие инженерные решения.

Если вы увидели классное решение, которое увеличило ваш навык, напишите об этом в комментариях автору. 
Маленькая благодарность принесёт огромную пользу всему проекту.

### Чек-лист для ревьюера

- Код хорошо спроектирован.
- Предоставленный интерфейс удобен пользователям кода и клиентским приложениям, а в итоге — конечным пользователям.
- Учтены возможные проблемы параллелизма.
- Код не переусложнён.
- Код реализует ровно то, что нужно в данный момент.
- Код покрыт тестами.
- Тесты хорошо спроектированы.
- Выбраны понятные названия для переменных, функций, классов.
- Комментарии полезные и описывают, почему написан код, а не что он делает.
- Код оформлен в соответствии с принятыми стандартами.